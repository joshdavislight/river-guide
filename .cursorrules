# River Guide Coding Rules

## Core Principles
- Human readability first
- Single responsibility per file/function
- Extract and reuse, never duplicate
- Max component size: 200 lines
- Max function size: 30 lines

## File Organization

**Utilities belong in `/lib/utils/`:**
- `riverHelpers.ts` - Business logic (permit checks, deadlines)
- `calendarHelpers.ts` - Display logic (colors, labels)
- `formatting.ts` - Generic formatters

**Extract inline logic to utils if:**
- Used in multiple places
- Over 3 lines of logic
- Complex business rules

## Component Structure
- Pages: Data loading only
- Components: Presentation + interaction
- No business logic in components

**Split components when >200 lines:**
```
Parent.svelte (orchestrator)
├── ChildFilters.svelte
├── ChildGrid.svelte
└── ChildPopup.svelte
```

## Code Patterns

### Replace repetitive conditionals with config:
```typescript
// Instead of multiple {#if} blocks:
const COLUMNS = [
  { key: 'location', label: 'Location' },
  { key: 'class', label: 'Class' }
];
{#each COLUMNS.filter(c => visible[c.key]) as col}
```

### Extract complex inline logic:
```typescript
// Instead of: {@const x = a ? b : c ? d : e}
// Use: {@const x = getComputedValue(data)}
```

### Reusable state patterns in `/lib/stores/`:
```typescript
// For localStorage, fetch patterns, etc.
export function useLocalStorage<T>(key: string, defaultValue: T)
```

## Quality Checklist
- No duplicate logic across files
- No magic numbers without constants/comments
- No commented-out code
- All imports used
- Functions <30 lines
- Components <200 lines
- Comment WHY not WHAT

## Naming
- Descriptive: `getPermitDeadlineText()` not `getDeadline()`
- Boolean functions: `isSelfIssuePermit()` not `checkPermit()`
- Constants: `UPPERCASE_WITH_UNDERSCORES`

## Types
- Always use TypeScript types
- Never use `any`

## When Refactoring Needed
- Seeing same logic twice
- Component over 200 lines
- Function over 30 lines
- Hard to understand without comments

Extract, simplify, reuse.